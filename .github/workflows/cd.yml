name: Android CD

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v4
     
     - name: set up JDK 11
       uses: actions/setup-java@v4
       with:
          distribution: 'zulu'
          java-version: '11'
       
     - name: Make gradlew executable
       run: chmod +x ./gradlew

     - name: Gradle cache
       uses: actions/cache@v4
       with:
         path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
         key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*') }}
         restore-keys: |
          ${{ runner.os }}-gradle-
       
     - name: Update Secrets
       env:
          KOIN_STORE_PASSWORD: $({ secrets.KOIN_STORE_PASSWORD})
          NAVER_MAP_KEY: $({ secrets.NAVER_MAP_KEY})
          SECRET_KEY : $({ secrets.SECRET_KEY })
       run: |
            echo "koin_store_password=$KOIN_STORE_PASSWORD\nnavermap_key=$NAVER_MAP_KEY" > ./local.properties
            echo "$SECRET_KEY" | base64 -di > ./koin/team_kap_android.jks
            for file in $(find . -name 'local.properties')
            do
             echo $file
            done
            for file in $(find . -name 'team_kap_android.jks')
            do
             echo $file
            done
          
     - name: Update Firebase
       env:
          FIREBASE: $({ secrets.FIREBASE })
       run: |
            echo "$FIREBASE" | base64 -d > ./koin/google-services.json          
            for file in $(find . -name 'google-services.json')
            do
             echo $file
            done
       
     - name: Build
       env:
          GOOGLE_APPLICATION_CREDENTIALS: $({ secrets.FIREBASE })
       run: |
             ./gradlew :koin:bundleRelease
           
